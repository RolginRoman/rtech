---
import {
  Configuration,
  FluidDesignSystemCSSInput,
  FluidDesignSystemConfig,
} from './interface.provider';
import { DEFAULT_CONFIG } from './config.provider';
import { buildFluidDesignSystem, generateCSS } from './fluid-design.builder';

interface Props {
  injectSelector?: string;
  postprocess?: (css: string) => string;
  config: Configuration;
}

const {
  injectSelector = 'html',
  postprocess = (css: string) => css,
  config: userConfig,
} = Astro.props;

function createEffectiveConfig(
  userConfig: Configuration
): FluidDesignSystemConfig {
  return { ...DEFAULT_CONFIG, ...userConfig };
}

const fluidDesignSystem: FluidDesignSystemCSSInput = buildFluidDesignSystem(
  createEffectiveConfig(userConfig)
);
---

<style set:html={postprocess(generateCSS(fluidDesignSystem, injectSelector))}
></style>
